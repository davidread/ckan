{% ckan_extends %}

{% block resource_actions_inner %}
  {{ super() }}
  {% if res.datastore_active %}
    <li>{% snippet 'package/snippets/data_api_button.html', resource=res %}</li>
  {% endif %}
{% endblock %}

{% block resource_additional_information_inner %}
  {% if res.datastore_active %}
    {% set ddict=h.datastore_dictionary(res.id) %}
    <div class="module-content">
      <h2>
        {{ _('Data Dictionary') }}
        <a class="btn btn-primary btn-small" href="/datastore/dictionary_download/{{res.id}}"><i class="icon-download"></i> Download</a>
      </h2>
      <table class="table table-striped table-bordered table-condensed" data-module="table-toggle-more">
        <thead>
          <tr>
            <th scope="col">{{ _('Column') }}</th>
            <th scope="col">{{ _('Type') }}</th>
            <th scope="col">{{ _('Label') }}</th>
            <th scope="col">{{ _('Description') }}</th>
          </tr>
        </thead>
        {% for f in ddict %}
          <tr {% if loop.index > 5 %}class="toggle-more"{% endif %}>
            <td>{{ f.id }}</td>
            <td>{{ f.type }}</td>
            <td>{{ h.get_translated(f.get('info', {}), 'label') }}</td>
            <td>{{ h.render_markdown(
              h.get_translated(f.get('info', {}), 'notes')) }}</td>
          </tr>
        {% endfor %}
      </table>
    </div>
  {% endif %}
  {% if res.query and h.check_access('resource_update', {'id':res.id}) %}
    <div class="module-content">
      <h2>{{ _('Resource Query') }}</h2>
      <p>{{ _('Click Run Query to update the data in this resource.') }}</p>
      <form class="form-horizontal" method="post" data-module="basic-form"
        action="{% url_for
          controller='ckanext.datastore.controller:DatastoreController',
          action='run_query', resource_id=res.id %}">
        <button class="btn btn-primary" name="run" value="query" type="submit">{{ _('Run Query') }}</button>
      </form>
    </div>
  {% endif %}
  {{ super() }}
{% endblock %}
